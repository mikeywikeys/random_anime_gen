<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Recommendation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: linear-gradient(to right, #4a4a4a, #6a6a6a);
            color: white;
        }
        .btn {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            cursor: pointer;
            color: white;
            border-radius: 5px;
        }
        .recommendation-card {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            margin-top: 20px;
            border-radius: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Anime Recommendation</h1>
    <h2>Select Your Genre</h2>
    <div id="genre-buttons"></div>
    <button class="btn" style="background: red;" onclick="fetchRecommendation()">Get Recommendations</button>
    
    <div id="recommendation" class="recommendation-card">
        <h3 id="anime-title"></h3>
        <p id="anime-rating"></p>
        <p id="anime-episodes"></p>
        <p id="anime-synopsis"></p>
        <a id="anime-link" target="_blank" style="color: cyan; text-decoration: underline;">Watch on HiAnime</a>
    </div>

    <script>
        const genreMap = {
            action: 1, romance: 22, fantasy: 10, slice_of_life: 36,
            adventure: 2, comedy: 4, drama: 8, horror: 14,
            mystery: 7, psychological: 40, sci_fi: 24
        };
        
        function createGenreButtons() {
            const container = document.getElementById("genre-buttons");
            for (const genre in genreMap) {
                const button = document.createElement("button");
                button.innerText = genre.replace("_", " ").toUpperCase();
                button.className = "btn";
                button.style.background = "gray";
                button.onclick = () => selectGenre(genre, button);
                container.appendChild(button);
            }
        }

        let selectedGenre = "";
        function selectGenre(genre, button) {
            selectedGenre = genre;
            document.querySelectorAll(".btn").forEach(btn => btn.style.background = "gray");
            button.style.background = "blue";
        }

        async function fetchRecommendation() {
            if (!selectedGenre) {
                alert("Please select a genre first.");
                return;
            }
            
            try {
                const response = await fetch("https://api.jikan.moe/v4/top/anime");
                const data = await response.json();
                const animeList = data.data.filter(anime => 
                    anime.type === "TV" && anime.genres.some(g => g.mal_id === genreMap[selectedGenre])
                );
                
                if (animeList.length === 0) {
                    alert("No anime found for this genre.");
                    return;
                }
                
                const anime = animeList[Math.floor(Math.random() * animeList.length)];
                document.getElementById("anime-title").innerText = anime.title;
                document.getElementById("anime-rating").innerText = "Rating: " + (anime.score || "N/A") + "‚≠ê";
                document.getElementById("anime-episodes").innerText = "Episodes: " + (anime.episodes || "Unknown");
                document.getElementById("anime-synopsis").innerText = anime.synopsis.split(".")[0] + ".";
                document.getElementById("anime-link").href = `https://www.google.com/search?q=site:hianime.to+${encodeURIComponent(anime.title)}`;
                document.getElementById("recommendation").style.display = "block";
            } catch (error) {
                console.error("Error fetching anime recommendations:", error);
                alert("Failed to fetch anime recommendations.");
            }
        }

        createGenreButtons();
    </script>
</body>
</html>